<div class="container mt-5 text-center">
  <!-- Imagen de perfil -->
  <!-- Imagen de perfil -->
  <div class="mb-4">
    <img
      [src]="profile?.profileImage || 'assets/default-avatar.png'"
      alt="Imagen de perfil"
      class="rounded-circle"
      width="150"
      height="150"
    />
  </div>

  <!-- Nombre de usuario sin editar -->
  <h4 class="mb-2">{{ profile?.username }}</h4>

  <!-- Roles -->
  <div *ngIf="profile?.roles?.length" class="mb-2">
    <span
      class="badge me-1"
      *ngFor="let role of profile?.roles"
      [ngStyle]="{
        'background-color': role.backgroundColor,
        color: role.textColor
      }"
    >
      {{ role.name }}
    </span>
  </div>

  <!-- Títulos -->
  <div *ngIf="profile?.titles?.length" class="mb-4">
    <span
      class="badge me-1"
      *ngFor="let title of profile?.titles"
      [ngStyle]="{
        'background-color': title.backgroundColor,
        color: title.textColor
      }"
    >
      {{ title.title }}
    </span>
  </div>

  <!-- Botón para abrir el modal (solo si es tu propio perfil) -->
  <button
    *ngIf="isOwnProfile"
    type="button"
    class="btn btn-outline-primary mb-3"
    data-bs-toggle="modal"
    data-bs-target="#editProfileModal"
  >
    Editar perfil
  </button>

  <!-- 🔽 Botón para mostrar descripción -->
  <div class="text-center mb-4">
    <button
      class="btn btn-outline-secondary"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#descriptionCollapse"
      aria-expanded="false"
      aria-controls="descriptionCollapse"
    >
      Ver descripción
    </button>
  </div>

  <!-- 🔽 Descripción colapsable -->
  <div class="collapse mb-4" id="descriptionCollapse">
    <div class="card card-body text-start">
      <div
        class="quill-content"
        [innerHTML]="
          profile?.description ||
          '<p class=\'text-muted\'>No hay descripción disponible.</p>'
        "
      ></div>
    </div>
  </div>

  <!-- Modal de edición (solo si es tu propio perfil) -->
  <div
    *ngIf="isOwnProfile"
    class="modal fade"
    id="editProfileModal"
    tabindex="-1"
    aria-labelledby="editProfileModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editProfileModalLabel">Editar perfil</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>

        <form [formGroup]="editForm" (ngSubmit)="onUpdateProfile()">
          <div class="modal-body">
            <div class="mb-3">
              <label for="username" class="form-label">Nombre de usuario</label>
              <input
                type="text"
                id="username"
                class="form-control"
                formControlName="username"
              />
            </div>

            <div class="mb-3">
              <label for="description" class="form-label">Descripción</label>
              <quill-editor
                formControlName="description"
                [styles]="{ height: '150px' }"
              ></quill-editor>
            </div>

            <div class="mb-3">
              <label for="image" class="form-label">Cambiar imagen</label>
              <input
                type="file"
                id="image"
                class="form-control"
                (change)="onImageSelected($event)"
              />
            </div>

            <div *ngIf="successMessage" class="alert alert-success mt-3">
              {{ successMessage }}
            </div>
            <div *ngIf="errorMessage" class="alert alert-danger mt-3">
              {{ errorMessage }}
            </div>
          </div>

          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cerrar
            </button>
            <button type="submit" class="btn btn-primary">
              Guardar cambios
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <hr class="my-5" />

  <!-- Tabs de publicaciones y comentarios -->
  <ul class="nav nav-tabs mb-4" id="profileTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button
        class="nav-link active"
        id="posts-tab"
        data-bs-toggle="tab"
        data-bs-target="#posts"
        type="button"
        role="tab"
      >
        Publicaciones
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button
        class="nav-link"
        id="comments-tab"
        data-bs-toggle="tab"
        data-bs-target="#comments"
        type="button"
        role="tab"
      >
        Comentarios
      </button>
    </li>
  </ul>

  <div class="tab-content">
    <!-- Publicaciones -->
    <div class="tab-pane fade show active" id="posts" role="tabpanel">
      <div *ngIf="posts.length > 0; else noPosts">
        <div
          *ngFor="let post of posts.slice().reverse()"
          class="card mb-3 text-start"
        >
          <div class="card-body">
            <h5 class="card-title">{{ post.title }}</h5>
            <div
              class="quill-content card-text"
              [innerHTML]="post.content"
            ></div>
            <div class="text-muted">Etiquetas: {{ post.tags.join(", ") }}</div>
            <div class="mt-2">❤️ {{ post.likes }} · 💬 {{ post.coments }}</div>
          </div>
        </div>
      </div>
      <ng-template #noPosts>
        <p>No hay publicaciones de este usuario aún.</p>
      </ng-template>
    </div>

    <!-- Comentarios -->
    <div class="tab-pane fade" id="comments" role="tabpanel">
      <form class="mb-4" *ngIf="myProfileId" (ngSubmit)="onSubmitComment()">
        <div class="input-group">
          <input
            type="text"
            class="form-control"
            [(ngModel)]="newComment"
            name="comment"
            placeholder="Escribe un comentario..."
          />
          <button class="btn btn-primary" type="submit">Enviar</button>
        </div>
      </form>

      <div *ngIf="comments.length > 0; else noComments">
        <div *ngFor="let comment of comments" class="card mb-3 text-start">
          <div class="card-body d-flex">
            <img
              [src]="
                comment.authorProfile.profileImage ||
                'assets/default-avatar.png'
              "
              class="rounded-circle me-3"
              width="50"
              height="50"
              alt="avatar"
            />
            <div>
              <h6 class="mb-1">{{ comment.authorProfile.username }}</h6>
              <p class="mb-0">{{ comment.content }}</p>
            </div>
          </div>
        </div>
      </div>
      <ng-template #noComments>
        <p>Este perfil no tiene comentarios aún.</p>
      </ng-template>
    </div>
  </div>
</div>
